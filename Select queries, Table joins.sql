/* Исходная база данных ко всем заданиям представляет вид

Таблица genre:
+----------+-------------+
| genre_id | name_genre  |
+----------+-------------+
| 1        | Роман       |
| 2        | Поэзия      |
| 3        | Приключения |
+----------+-------------+

Таблица author:
+-----------+------------------+
| author_id | name_author      |
+-----------+------------------+
| 1         | Булгаков М.А.    |
| 2         | Достоевский Ф.М. |
| 3         | Есенин С.А.      |
| 4         | Пастернак Б.Л.   |
| 5         | Лермонтов М.Ю.   |
+-----------+------------------+

Таблица supply:
+-----------+----------------+------------------+--------+--------+
| supply_id | title          | author           | price  | amount |
+-----------+----------------+------------------+--------+--------+
| 1         | Доктор Живаго  | Пастернак Б.Л.   | 618.99 | 3      |
| 2         | Черный человек | Есенин С.А.      | 570.20 | 6      |
| 3         | Евгений Онегин | Пушкин А.С.      | 440.80 | 5      |
| 4         | Идиот          | Достоевский Ф.М. | 360.80 | 3      |
+-----------+----------------+------------------+--------+--------+

Таблица book:
+---------+-----------------------+-----------+----------+--------+--------+
| book_id | title                 | author_id | genre_id | price  | amount |
+---------+-----------------------+-----------+----------+--------+--------+
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 1        | 540.50 | 5      |
| 3       | Идиот                 | 2         | 1        | 460.00 | 10     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 2        | 570.20 | 6      |
| 8       | Лирика                | 4         | 2        | 518.99 | 2      |
+---------+-----------------------+-----------+----------+--------+--------+

*/



/* Вывести название, жанр и цену тех книг, количество которых больше 8, в отсортированном по
убыванию цены виде. */

SELECT title, name_genre, price
FROM 
    genre INNER JOIN book
    ON genre.genre_id = book.genre_id
WHERE book.amount > 8
ORDER BY book.price DESC;



/* Вывести все жанры, которые не представлены в книгах на складе.  */

SELECT genre.name_genre 
FROM genre LEFT JOIN book
     ON genre.genre_id = book.genre_id
     WHERE book.genre_id IS NULL;



/* Есть список городов, хранящийся в таблице city:

city_id	name_city
1	Москва
2	Санкт-Петербург
3	Владивосток

Необходимо в каждом городе провести выставку книг каждого автора в течение 2020 года. Дату
проведения выставки выбрать случайным образом. Создать запрос, который выведет город, автора
и дату проведения выставки. Последний столбец назвать Дата. Информацию вывести, отсортировав
сначала в алфавитном порядке по названиям городов, а потом по убыванию дат проведения выставок. */

SELECT name_city, name_author, DATE_ADD('2020-01-01', INTERVAL FLOOR(RAND() * 365) DAY) AS Дата
FROM 
    city CROSS JOIN author
ORDER BY name_city, Дата DESC;



/* Вывести информацию о книгах (жанр, книга, автор), относящихся к жанру, включающему слово «роман»
в отсортированном по названиям книг виде. */

SELECT name_genre, title, name_author
FROM
    genre 
    INNER JOIN  book ON genre.genre_id = book.genre_id
    INNER JOIN author ON author.author_id = book.author_id
WHERE name_genre LIKE '%роман%'
ORDER BY title;



/* Посчитать количество экземпляров  книг каждого автора из таблицы author.  Вывести тех авторов, 
количество книг которых меньше 10, в отсортированном по возрастанию количества виде. Последний столбец
назвать Количество. */

SELECT name_author, SUM(amount) AS Количество
FROM 
    author LEFT JOIN book
    on author.author_id = book.author_id
GROUP BY name_author
HAVING SUM(amount) < 10 OR SUM(amount) IS NULL
ORDER BY Количество;



/* Вывести в алфавитном порядке всех авторов, которые пишут только в одном жанре. Поскольку у нас в
таблицах так занесены данные, что у каждого автора книги только в одном жанре,  для этого запроса
внесем изменения в таблицу book. Пусть у нас  книга Есенина «Черный человек» относится к жанру «Роман»,
а книга Булгакова «Белая гвардия» к «Приключениям» (эти изменения в таблицы уже внесены). */

SELECT name_author
FROM
    author INNER JOIN book
    on author.author_id = book.author_id
GROUP BY name_author
HAVING COUNT(DISTINCT genre_id) = 1;



/* Если в таблицах supply  и book есть одинаковые книги, которые имеют равную цену,  вывести их название
и автора, а также посчитать общее количество экземпляров книг в таблицах supply и book,  столбцы назвать
Название, Автор  и Количество. */

SELECT book.title AS Название, name_author AS Автор, book.amount + supply.amount AS Количество
FROM 
    author 
    INNER JOIN book USING (author_id)   
    INNER JOIN supply ON book.title = supply.title 
                         AND book.price = supply.price;